<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="person">

    <typeAlias alias="person" type="com.hangzhou.tfchen.bean.Person"/>
    <typeAlias alias="son" type="com.hangzhou.tfchen.bean.Son"/>

    <resultMap id="sonsonMap" class="son">
        <result property="id" column="sid"/>
        <result property="name" column="sname"/>
        <result property="age" column="sage"/>
        <result property="personId" column="spid"/>
    </resultMap>

    <resultMap id="personMap" class="person" groupBy="id">
        <result property="id" column="pid"/>
        <result property="name" column="pname"/>
        <result property="city" column="pcity"/>
        <result property="age" column="page"/>
        <result property="birthDay" column="pbi"/>
        <result property="sons" resultMap="person.sonsonMap"/>
    </resultMap>

    <resultMap id="personMapTwo" class="person">
        <result property="id" column="pid"/>
        <result property="name" column="pname"/>
        <result property="city" column="pcity"/>
        <result property="age" column="page"/>
        <result property="birthDay" column="pbi"/>
        <result property="sons" column="pid" select="selectSonByPersonId"/>
    </resultMap>

    <insert id="insertPerson" parameterClass="person">
			INSERT INTO person(id,name,city,age,birthDay)
			values(person_seq.nextval,#name#,#city#,#age#,#birthDay#)
	</insert>

    <select id="selectPersonWhereIdBelow" parameterClass="Integer" resultClass="person">
		select id, name, city, age, birthDay from person where #value# > id
	</select>

    <select id="selectPersonContantSonWhereIdBelow" parameterClass="Integer" resultMap="personMap">
		select t1.id       as pid,
               t1.name     as pname,
               t1.city     as pcity,
               t1.age      as page,
               t1.birthDay as pbi,
               t2.id       as sid,
               t2.name     as sname,
               t2.age      as sage,
               t2.person_id as spid
          from person t1
          LEFT JOIN son t2
            ON t1.id = t2.person_id
         where #value# > t1.id
	</select>

    <select id="findPersonContantSonWhereIdBelow2" parameterClass="Integer" resultMap="personMapTwo">
        select t1.id       as pid,
               t1.name     as pname,
               t1.city     as pcity,
               t1.age      as page,
               t1.birthDay as pbi
          from person t1
          where #value# > t1.id
    </select>

</sqlMap>